<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>–° –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è, –°–µ—Ä–≥–µ–π –í–∞–ª–µ–Ω—Ç–∏–Ω–æ–≤–∏—á!</title>
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —à—Ä–∏—Ñ—Ç—ã -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <style>
    /* –ë–∞–∑–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Å–±—Ä–æ—Å */
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--bg1:#667eea;--bg2:#764ba2;--glass:rgba(255,255,255,.95);--accent:#ff6b6b}
    body{
      min-height:100vh;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      overflow-x:hidden;
      position:relative;
    }

    /* Canvas –¥–ª—è —Å–∞–ª—é—Ç–∞ */
    #fireworksCanvas{
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:200;
      mix-blend-mode: screen;
      opacity:0.85;
    }

    /* –°–ª–∞–±–∞—è —Ñ–æ–Ω–æ–≤–∞—è –ø—ã–ª—å */
    .particles{position:fixed;inset:0;pointer-events:none;z-index:1}
    .particle{position:absolute;width:4px;height:4px;border-radius:50%;background:rgba(255,255,255,.8);animation:float 15s linear infinite}
    @keyframes float{0%{transform:translateY(100vh) rotate(0);opacity:0}10%,90%{opacity:1}100%{transform:translateY(-100vh) rotate(360deg);opacity:0}}

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø–æ–∑–¥—Ä–∞–≤–∏—Ç–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ */
    .container{position:relative;z-index:10;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
    .birthday-card{
      width:min(640px,100%);
      background:var(--glass);
      backdrop-filter:blur(20px);
      border-radius:24px;
      padding:22px;
      box-shadow:0 25px 50px rgba(0,0,0,.15),0 0 0 1px rgba(255,255,255,.08);
      transform:translateY(20px);
      opacity:0;
      animation:slideUp .8s ease-out .2s forwards;
      position:relative;
      overflow:hidden;
    }
    @keyframes slideUp{to{transform:translateY(0);opacity:1}}
    .card-decoration{position:absolute;width:160px;height:160px;border-radius:50%;top:-50px;right:-50px;opacity:.08;background:linear-gradient(45deg,#ff6b6b,#ffd93d);animation:pulse 3s ease-in-out infinite}
    .card-decoration:nth-child(2){top:auto;bottom:-40px;left:-40px;right:auto;background:linear-gradient(45deg,#4ecdc4,#44a08d);animation-delay:1s}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
    .main-title{
      font-family:'Dancing Script',cursive;
      font-size:clamp(2.4rem,6vw,3.8rem);
      font-weight:700;
      text-align:center;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      -webkit-background-clip:text;
      background-clip:text;
      -webkit-text-fill-color:transparent;
      margin-bottom:6px;
    }
    .subtitle{
      text-align:center;
      font-size:1.05rem;
      color:#666;
      margin-bottom:18px;
      font-weight:300;
    }

    /* –ê–≤–∞—Ç–∞—Ä */
    .avatar-container{display:flex;justify-content:center;margin-bottom:18px}
    .avatar{
      width:160px;height:160px;border-radius:50%;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center;
      color:#fff;font-size:3rem;font-weight:800;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      border:6px solid #fff;box-shadow:0 12px 28px rgba(0,0,0,.18);
      animation:bounce 2s ease-in-out infinite;
    }
    .avatar::before{content:"";position:absolute;inset:-50%;background:linear-gradient(45deg,transparent,rgba(255,255,255,.32),transparent);transform:rotate(45deg);animation:shine 3s ease-in-out infinite}
    .avatar .initials{position:relative;z-index:1}
    @keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-10px)}60%{transform:translateY(-5px)}}
    @keyframes shine{0%{transform:translate(-100%,-100%) rotate(45deg)}50%{transform:translate(100%,100%) rotate(45deg)}100%{transform:translate(-100%,-100%) rotate(45deg)}}

    /* –ü–µ—á–∞—Ç–∞—é—â–∏–π—Å—è —Ç–µ–∫—Å—Ç */
    .typewriter{
      font-size:1.1rem;
      font-weight:800;
      color:var(--accent);
      text-align:center;
      margin:10px 0 14px;
      min-height:56px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0 8px;
    }
    .cursor{display:inline-block;width:2px;background:var(--accent);margin-left:4px;animation:blink 1s infinite}
    @keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}
    .wrong{position:relative;color:#d35c5c;text-decoration:line-through;text-decoration-thickness:2px}

    /* –°–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–¥–ø–∏—Å—å */
    .message{font-size:1.02rem;line-height:1.65;color:#3a3a3a;text-align:center}
    .message p{margin-bottom:10px}
    .signature{text-align:center;font-size:1.08rem;font-weight:700;color:#5263e9;margin-top:16px}

    /* –ö–Ω–æ–ø–∫–∞ —Å–∞–ª—é—Ç–∞ */
    .fireworks-btn{
      display:block;
      margin:20px auto 0;
      padding:12px 28px;
      background:linear-gradient(135deg,#ff6b6b,#ff8787);
      color:white;
      border:none;
      border-radius:50px;
      font-size:1.05rem;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 8px 20px rgba(255,107,107,.3);
      transition:all .3s ease;
      position:relative;
      overflow:hidden;
    }
    .fireworks-btn:hover{transform:translateY(-2px);box-shadow:0 12px 28px rgba(255,107,107,.4)}
    .fireworks-btn:active{transform:translateY(0)}
    .fireworks-btn::before{
      content:"";
      position:absolute;
      top:50%;
      left:50%;
      width:0;
      height:0;
      border-radius:50%;
      background:rgba(255,255,255,.3);
      transform:translate(-50%,-50%);
      transition:width .6s,height .6s;
    }
    .fireworks-btn:active::before{width:300px;height:300px}

    /* –ü–∞–¥–∞—é—â–∏–µ —ç–º–æ–¥–∑–∏ */
    .emoji-rain{position:fixed;inset:0;pointer-events:none;z-index:5}
    .falling-emoji{position:absolute;font-size:22px;animation:fall 4.8s linear forwards}
    @keyframes fall{from{transform:translateY(-100vh) rotate(0);opacity:1}to{transform:translateY(100vh) rotate(360deg);opacity:0}}

    @media (max-width:768px){
      .birthday-card{padding:20px}
      .avatar{width:132px;height:132px;font-size:2.5rem}
      .typewriter{font-size:1.02rem;min-height:48px}
      .message{font-size:.98rem}
    }
  </style>
</head>
<body>
  <!-- Canvas –¥–ª—è —Å–∞–ª—é—Ç–∞ -->
  <canvas id="fireworksCanvas"></canvas>
  
  <!-- –§–æ–Ω–æ–≤–∞—è –ø—ã–ª—å -->
  <div class="particles" id="particles"></div>
  <!-- –ü–∞–¥–∞—é—â–∏–µ —ç–º–æ–¥–∑–∏ -->
  <div class="emoji-rain" id="emojiRain"></div>

  <div class="container">
    <div class="birthday-card">
      <div class="card-decoration"></div>
      <div class="card-decoration"></div>
      
      <h1 class="main-title">–° –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è!</h1>
      <p class="subtitle">–°–µ—Ä–≥–µ–π –í–∞–ª–µ–Ω—Ç–∏–Ω–æ–≤–∏—á</p>
      
      <div class="avatar-container">
        <div class="avatar" id="avatar"><span class="initials">–°–í</span></div>
      </div>
      
      <div class="typewriter"><span id="typewriter-text"></span><span class="cursor">&nbsp;</span></div>
      
      <div class="message">
        <p>–ñ–µ–ª–∞–µ–º –º–æ—â–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è, –ª—ë–≥–∫–∏—Ö –ø–æ–±–µ–¥ –∏ —Ä–æ–≤–Ω–æ–≥–æ –æ–≥–Ω—è –≤ –¥–µ–ª–∞—Ö! üî•</p>
        <p>–ü—É—Å—Ç—å –±–∞–Ω—å–∫–∞ –≤—Å–µ–≥–¥–∞ –≤ —Ç–æ–Ω—É—Å–µ, –º–∞–Ω–≥–∞–ª ‚Äî –±–µ–∑ –¥—ã–º–∞ –≤ –≥–ª–∞–∑–∞, –∞ –≤—ã—Ö–æ–¥–Ω—ã–µ ‚Äî —Å–ø–ª–æ—à–Ω—ã–µ ¬´–≤–∞—É-–º–æ–º–µ–Ω—Ç—ã¬ª. ‚ú®</p>
        <p>–ü—É—Å—Ç—å –Ω–æ–≤—ã–π –≥–æ–¥ –∂–∏–∑–Ω–∏ –∫–∞—á–∞–µ—Ç –∫–∞–∫ –ª—é–±–∏–º—ã–π —Ç—Ä–µ–∫: –≥—Ä–æ–º–∫–æ, —á–∏—Å—Ç–æ –∏ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ! –ë–æ–ª—å—à–µ —Å–º–µ—Ö–∞, –≤–∫—É—Å–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á –∏ –ø–æ–≤–æ–¥–æ–≤ –¥–ª—è –≥–æ—Ä–¥–æ—Å—Ç–∏! üéµ</p>
      </div>
      
      <div class="signature">–° —Ç–µ–ø–ª–æ–º ‚Äî –ê–Ω–∞—Ç–æ–ª–∏–π –∏ –ò—Ä–∏–Ω–∞ ‚ù§Ô∏è</div>
      
      <button class="fireworks-btn" onclick="launchFireworks()">üéÜ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∞–ª—é—Ç!</button>
    </div>
  </div>

<script>
/*
  –§–æ–Ω–æ–≤–∞—è –ø—ã–ª—å: —Å–æ–∑–¥–∞—ë–º –º–∞–ª–µ–Ω—å–∫–∏–µ —Ç–æ—á–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–µ–¥–ª–µ–Ω–Ω–æ –¥–≤–∏–∂—É—Ç—Å—è —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑.
*/
(function(){
  const wrap=document.getElementById('particles');
  const count=48;
  for(let i=0;i<count;i++){
    const d=document.createElement('div');
    d.className='particle';
    d.style.left=(Math.random()*100)+'%';
    d.style.animationDelay=(Math.random()*15)+'s';
    d.style.animationDuration=(14+Math.random()*10)+'s';
    wrap.appendChild(d);
  }
})();

/*
  –ü–∞–¥–∞—é—â–∏–µ —ç–º–æ–¥–∑–∏: —Å–ª—É—á–∞–π–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –ø–∞–¥–∞—é—Ç —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑, —Å–æ–∑–¥–∞–≤–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –ø—Ä–∞–∑–¥–Ω–∏–∫–∞.
*/
(function(){
  const emojis=['üéâ','üéÇ','üéà','üéÅ','‚ú®','üåü','üí´','üéä'];
  const rain=document.getElementById('emojiRain');
  setInterval(()=>{
    const e=document.createElement('div');
    e.className='falling-emoji';
    e.textContent=emojis[Math.floor(Math.random()*emojis.length)];
    e.style.left=(Math.random()*100)+'%';
    e.style.animationDuration=(3.6+Math.random()*2.2)+'s';
    rain.appendChild(e);
    setTimeout(()=>e.remove(),5200);
  },380);
})();

/*
  –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞: –µ—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è, –æ–Ω–∞ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∞ –≤–º–µ—Å—Ç–æ –∏–Ω–∏—Ü–∏–∞–ª–æ–≤.
*/
(function(){
  const avatar=document.getElementById('avatar');
  const initials=avatar.querySelector('.initials');
  const candidates=[
    "./sergey.jpg","./sergey.JPG","./sergey.jpeg","./sergey.JPEG",
    "./sergey.png","./sergey.PNG","./sergey.webp","./sergey.WEBP",
    "sergey.jpg","sergey.JPG","sergey.jpeg","sergey.JPEG",
    "sergey.png","sergey.PNG","sergey.webp","sergey.WEBP",
    "./photo.jpg","./photo.JPG","./photo.jpeg","./photo.JPEG",
    "./photo.png","./photo.PNG","photo.jpg","photo.JPG",
    "./image.jpg","./image.JPG","image.jpg","image.JPG"
  ];
  let i=0;
  function tryNext(){
    if(i>=candidates.length) return;
    const img=new Image();
    img.onload=function(){
      initials.style.display='none';
      Object.assign(img.style,{
        position:'absolute',inset:'0',width:'100%',height:'100%',objectFit:'cover',borderRadius:'50%',zIndex:'0',opacity:'0',transition:'opacity .5s'
      });
      avatar.appendChild(img);
      requestAnimationFrame(()=>img.style.opacity='1');
    };
    img.onerror=function(){ i++; setTimeout(tryNext,10); };
    img.src=candidates[i] + "?v=" + Date.now();
  }
  setTimeout(tryNext,120);
})();

/*
  –ü–µ—á–∞—Ç–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: –ø–ª–∞–≤–Ω–æ –≤—ã–≤–æ–¥–∏—Ç —Å—Ç—Ä–æ–∫–∏, —Å–Ω–∞—á–∞–ª–∞ –ø–µ—á–∞—Ç–∞—è ¬´–æ—à–∏–±–æ—á–Ω—ã–π¬ª –≤–∞—Ä–∏–∞–Ω—Ç —Å–ª–æ–≤–∞, –∑–∞—Ç–µ–º —Å—Ç–∏—Ä–∞—è –µ–≥–æ –∏ –ø–µ—á–∞—Ç–∞—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π. –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—É–∑–∞.
*/
(function(){
  const el=document.getElementById('typewriter-text');
  const lines=[
    ["–ñ–µ–ª–∞–µ–º ", "–æ–±—ã—á–Ω–æ–≥–æ", "–∫—Ä–µ–ø–∫–æ–≥–æ", " –∑–¥–æ—Ä–æ–≤—å—è –∏ –±–æ–¥—Ä–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ—è! üí™"],
    ["–ü—É—Å—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ –±—É–¥—É—Ç ", "–æ–±—ã—á–Ω—ã–º–∏", "—è—Ä–∫–∏–º–∏", " –∏ –∑–∞–ø–æ–º–∏–Ω–∞—é—â–∏–º–∏—Å—è! ‚ú®"],
    ["–ú–∞–Ω–≥–∞–ª ‚Äî ", "–¥—ã–º–Ω—ã–π", "–±–µ–∑–¥—ã–º–Ω—ã–π", ", –∞ –º—è—Å–æ ‚Äî —Å–æ—á–Ω–æ–µ! üçñ"],
    ["–í –¥–µ–ª–∞—Ö ‚Äî ", "–ø–∞—É–∑–∞", "—É—Å–∫–æ—Ä–µ–Ω–∏–µ", " –∏ —É–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø–æ–±–µ–¥—ã! üöÄ"]
  ];
  const typeDelay=70, eraseDelay=45, holdWrong=700, holdLine=1200, gap=260;
  function typeText(text,start){ return new Promise(res=>{
    let i=start??0;
    function step(){ el.textContent=text.slice(0,i+1); i++; if(i<text.length) setTimeout(step,typeDelay); else res(); }
    if(text.length) setTimeout(step,typeDelay); else res();
  }); }
  function wrapWrong(pre,wrong){ el.innerHTML = `${pre}<span class="wrong" id="wrong-span">${wrong}</span>`; }
  function eraseWrong(){ return new Promise(res=>{
    const span=document.getElementById('wrong-span'); if(!span) return res();
    (function step(){ const t=span.textContent; if(t.length){ span.textContent=t.slice(0,-1); setTimeout(step,eraseDelay); } else { span.remove(); res(); }})();
  }); }
  async function play([pre,wrong,right,post]){
    el.textContent="";
    await new Promise(r=>setTimeout(r,gap));
    await typeText(pre+wrong,0);
    wrapWrong(pre,wrong);
    await new Promise(r=>setTimeout(r,holdWrong));
    await eraseWrong();
    await typeText(pre+right,0);
    await typeText(pre+right+post,(pre+right).length);
    await new Promise(r=>setTimeout(r,holdLine));
  }
  (async function loop(){ let idx=0; while(true){ await play(lines[idx%lines.length]); idx++; }})();
})();

/*
  –†–ï–ê–õ–ò–°–¢–ò–ß–ù–´–ô –°–ê–õ–Æ–¢
*/
const canvas = document.getElementById('fireworksCanvas');
const ctx = canvas.getContext('2d');
let fireworks = [];
let particles = [];
let autoLaunchInterval;

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ canvas
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

// –ö–ª–∞—Å—Å –¥–ª—è —á–∞—Å—Ç–∏—Ü
class Particle {
  constructor(x, y, color, velocity, size = 3, trail = true) {
    this.x = x;
    this.y = y;
    this.color = color;
    this.velocity = velocity;
    this.size = size;
    this.trail = trail;
    this.opacity = 1;
    this.decay = Math.random() * 0.015 + 0.003;
    this.gravity = 0.1;
    this.history = [];
    this.maxHistory = trail ? 15 : 0;
  }

  update() {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è —Å–ª–µ–¥–∞
    if (this.trail && this.history.length < this.maxHistory) {
      this.history.push({ x: this.x, y: this.y, opacity: this.opacity });
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é
    this.x += this.velocity.x;
    this.y += this.velocity.y;
    
    // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è –∏ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ
    this.velocity.y += this.gravity;
    this.velocity.x *= 0.99;
    this.velocity.y *= 0.99;
    
    // –£–º–µ–Ω—å—à–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
    this.opacity -= this.decay;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é
    this.history.forEach((point, index) => {
      point.opacity *= 0.95;
    });
  }

  draw() {
    ctx.save();
    
    // –†–∏—Å—É–µ–º —Å–ª–µ–¥ —Å –º–µ–Ω—å—à–µ–π –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é
    if (this.trail) {
      this.history.forEach((point, index) => {
        ctx.beginPath();
        ctx.arc(point.x, point.y, this.size * (index / this.history.length) * 0.8, 0, Math.PI * 2);
        ctx.fillStyle = this.color.replace('rgb', 'rgba').replace(')', `, ${point.opacity * 0.5})`);
        ctx.fill();
      });
    }
    
    // –†–∏—Å—É–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —á–∞—Å—Ç–∏—Ü—É —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º —Å–≤–µ—á–µ–Ω–∏—è
    ctx.shadowBlur = 15;
    ctx.shadowColor = this.color;
    
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
    ctx.fillStyle = this.color.replace('rgb', 'rgba').replace(')', `, ${this.opacity * 0.8})`);
    ctx.fill();
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size * 1.5, 0, Math.PI * 2);
    ctx.fillStyle = this.color.replace('rgb', 'rgba').replace(')', `, ${this.opacity * 0.2})`);
    ctx.fill();
    
    ctx.restore();
  }
}

// –ö–ª–∞—Å—Å –¥–ª—è —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–∞
class Firework {
  constructor(sx, sy, tx, ty) {
    this.x = sx;
    this.y = sy;
    this.sx = sx;
    this.sy = sy;
    this.tx = tx;
    this.ty = ty;
    this.distanceToTarget = Math.hypot(tx - sx, ty - sy);
    this.distanceTraveled = 0;
    this.coordinates = [];
    this.coordinateCount = 5;
    while (this.coordinateCount--) {
      this.coordinates.push([this.x, this.y]);
    }
    this.angle = Math.atan2(ty - sy, tx - sx);
    this.speed = 2;
    this.acceleration = 1.05;
    this.brightness = Math.random() * 50 + 50;
    this.targetRadius = 1;
  }

  update(index) {
    this.coordinates.pop();
    this.coordinates.unshift([this.x, this.y]);

    if (this.targetRadius < 8) {
      this.targetRadius += 0.3;
    } else {
      this.targetRadius = 1;
    }

    this.speed *= this.acceleration;
    const vx = Math.cos(this.angle) * this.speed;
    const vy = Math.sin(this.angle) * this.speed;

    this.distanceTraveled = Math.hypot(this.x + vx - this.sx, this.y + vy - this.sy);

    if (this.distanceTraveled >= this.distanceToTarget) {
      createParticles(this.tx, this.ty);
      fireworks.splice(index, 1);
    } else {
      this.x += vx;
      this.y += vy;
    }
  }

  draw() {
    ctx.beginPath();
    ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
    ctx.lineTo(this.x, this.y);
    ctx.strokeStyle = `hsl(${Math.random() * 360}, 100%, ${this.brightness}%)`;
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(this.tx, this.ty, this.targetRadius, 0, Math.PI * 2);
    ctx.stroke();
  }
}

// –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –≤–∑—Ä—ã–≤–∞
function createParticles(x, y) {
  const particleCount = 80 + Math.floor(Math.random() * 40);
  const hue = Math.random() * 360;
  const colors = [
    `hsl(${hue}, 100%, 70%)`,
    `hsl(${hue + 30}, 100%, 75%)`,
    `hsl(${hue - 30}, 100%, 70%)`,
    `hsl(${hue + 60}, 100%, 80%)`,
    `hsl(${hue - 60}, 100%, 75%)`
  ];
  
  // –û—Å–Ω–æ–≤–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã
  for (let i = 0; i < particleCount; i++) {
    const angle = (Math.PI * 2 / particleCount) * i + Math.random() * 0.5;
    const velocity = Math.random() * 4 + 2;
    const color = colors[Math.floor(Math.random() * colors.length)];
    
    particles.push(new Particle(
      x,
      y,
      color,
      {
        x: Math.cos(angle) * velocity,
        y: Math.sin(angle) * velocity
      },
      Math.random() * 1.5 + 0.5,
      true
    ));
  }
  
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–∫—Ä—ã
  for (let i = 0; i < 20; i++) {
    const angle = Math.random() * Math.PI * 2;
    const velocity = Math.random() * 2 + 1;
    
    particles.push(new Particle(
      x,
      y,
      'rgba(255, 255, 255, 0.8)',
      {
        x: Math.cos(angle) * velocity,
        y: Math.sin(angle) * velocity
      },
      Math.random() * 1 + 0.5,
      false
    ));
  }
  
  // –≠—Ñ—Ñ–µ–∫—Ç –≤—Å–ø—ã—à–∫–∏
  flashScreen(colors[0]);
}

// –≠—Ñ—Ñ–µ–∫—Ç –≤—Å–ø—ã—à–∫–∏
function flashScreen(color) {
  ctx.save();
  ctx.fillStyle = color.replace('hsl', 'hsla').replace(')', ', 0.05)');
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.restore();
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ —Å–∞–ª—é—Ç–∞
function launchFireworks() {
  // –ó–∞–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ª–ø–æ–≤
  for (let i = 0; i < 5; i++) {
    setTimeout(() => {
      fireworks.push(new Firework(
        Math.random() * canvas.width,
        canvas.height,
        Math.random() * canvas.width,
        Math.random() * canvas.height * 0.5
      ));
    }, i * 200);
  }
  
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫
  if (!autoLaunchInterval) {
    autoLaunchInterval = setInterval(() => {
      if (Math.random() < 0.15) {
        fireworks.push(new Firework(
          Math.random() * canvas.width,
          canvas.height,
          Math.random() * canvas.width,
          Math.random() * canvas.height * 0.6
        ));
      }
    }, 500);
  }
}

// –ê–Ω–∏–º–∞—Ü–∏—è
function animate() {
  // –û—á–∏—â–∞–µ–º canvas –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–ª—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // –û–±–Ω–æ–≤–ª—è–µ–º –∏ —Ä–∏—Å—É–µ–º —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–∏
  let i = fireworks.length;
  while (i--) {
    fireworks[i].draw();
    fireworks[i].update(i);
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –∏ —Ä–∏—Å—É–µ–º —á–∞—Å—Ç–∏—Ü—ã
  let j = particles.length;
  while (j--) {
    particles[j].draw();
    particles[j].update();

    if (particles[j].opacity <= 0) {
      particles.splice(j, 1);
    }
  }

  requestAnimationFrame(animate);
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
animate();

// –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Å–∞–ª—é—Ç–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
setTimeout(() => {
  launchFireworks();
}, 2000);

// –ó–∞–ø—É—Å–∫ —Å–∞–ª—é—Ç–∞ –ø–æ –∫–ª–∏–∫—É –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ
canvas.style.pointerEvents = 'auto';
canvas.addEventListener('click', (e) => {
  fireworks.push(new Firework(
    e.clientX,
    canvas.height,
    e.clientX,
    e.clientY
  ));
});
</script>
</body>
</html>
